var loadModule = require( './loadModule' ),
	fs   = require( 'fs' ),
	glob = require( 'glob'),
	_    = require( 'underscore' )


module.exports = function( sourcePath ) {
	var filePattern = sourcePath + '/**/*.js',
		filePaths = glob.sync( filePattern, {} )

	return _.reduce(
		filePaths,
		function( memo, filePath ) {
			var module = loadModule( filePath )

			if( module ) {
				memo[ module.name ] = _.pick( module, [ 'dependencies', 'source', 'path' ] )
			}

			return memo
		},
		{}
	)
}
