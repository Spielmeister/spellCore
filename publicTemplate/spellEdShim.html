<!DOCTYPE html>
<html>
	<head>
		<title>SpellEd</title>
		<link rel="stylesheet" href="main.css" type="text/css" />
		<script type="text/javascript" src="spell.js"></script>
	</head>

	<body>
		<div id="spell"></div>
		<script type="text/javascript">
			( function() {
				var editorOrigin = 'http://localhost:3000'

				var getParam = function( name ) {
					name = name.replace( /[\[]/, "\\\[" ).replace( /[\]]/, "\\\]" )
					var regexS = '[\\?&]' + name + '=([^&#]*)'
					var regex = new RegExp( regexS )
					var results = regex.exec( window.location.href )

					return ( results == null ? '' : results[ 1 ] )
				}

				var receiveMessage = function( event ) {
					if( event.origin !== editorOrigin ) {
						console.log( 'event.origin: ' + event.origin )
						console.log( 'Error: origin does not match.' )

						return
					}

					if( event.data.type === 'run' ) {
						var config = {
							debug : true,
							platform : 'html5'
						}

						spell.start( config )

					} else if( event.data.type === 'debug' ) {
						spell.sendDebugMessage( event.data )
					}
				}

				var init = function() {
					window.addEventListener( 'message', receiveMessage, false )

					parent.window.postMessage(
						{
							action: 'initialized',
							iframeId: getParam( 'iframeId' )
						},
						editorOrigin
					)
				}

				init()
			} )()
		</script>
	</body>
</html>
